# 下载并发与暂停/恢复优化任务单

## 目标
- 避免后端调度器“吃掉队列但不启动”的问题，防止任务随机丢失/挂起。
- 防止重复启动同一任务导致的并发冲突和文件竞争。
- 改善暂停→恢复过程的状态一致性，确保状态/进度稳定落盘，便于刷新后继续。

## 任务拆解
1) **停用或修正空跑的后台调度器**
   - 现状：`task_scheduler` 会从队列 pop 任务但并未真正启动下载，只是 sleep，导致队列被清空而任务仍是 Pending。
   - 方案：先停用这个调度器，避免破坏队列。后续若要重构，再接入真实的 start_download。
   - 交付：不再 spawn `task_scheduler`。

2) **防重复启动同一任务**
   - 现状：`start_download_impl` 不检查活跃任务，重复点击“开始”可能并发两个句柄操作同一文件。
   - 方案：在启动前检查任务状态和 `active_downloads`，若已在下载或句柄存在，直接返回 OK。
   - 交付：幂等的 start_download。

3) **暂停/恢复的状态稳定性**
   - 现状：暂停时只 abort 句柄+改状态，若最后一帧进度没写回，刷新后进度可能略有回退。
   - 方案：保持事件写回；暂停时确保清理活跃句柄并刷新统计（已有）。如需要更稳，可在后续扩展为主动刷进度。
   - 交付：本轮保持现有事件写回链路，确保暂停后状态不会被刷新覆盖，恢复从原文件续传。

## 完成标准
- 队列不会被后台调度器吞掉；启动/暂停/恢复行为仅由显式命令驱动。
- 同一任务重复点击“开始”不会产生重复句柄。
- 暂停后刷新列表再恢复，状态和进度保持一致，继续原文件位置下载。
